<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rainwise ROI Calculator - AI Forester</title>
  <meta name="description" content="Calculate your water savings and ROI for converting spray irrigation to drip systems. Includes comprehensive rebate calculations for all RDN homeowner rebate programs.">
  
  <!-- Microsoft Clarity Tracking -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "r6fqdz0i2c");
  </script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- Main CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">
  
  <style>
    /* Calculator specific styles */
    .calculator-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .email-gate-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 3rem;
      text-align: center;
      margin-bottom: 3rem;
    }
    
    .email-gate-section h2 {
      font-size: 2rem;
      color: var(--primary-dark);
      margin-bottom: 1rem;
    }
    
    .email-gate-section p {
      font-size: 1.1rem;
      color: var(--gray);
      margin-bottom: 2rem;
    }
    
    .benefits-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
      text-align: left;
    }
    
    .benefit-card {
      background: #f8f9fa;
      padding: 1.5rem;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
    }
    
    .benefit-card i {
      color: var(--accent);
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    
    .benefit-card h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
    }
    
    .benefit-card p {
      font-size: 0.9rem;
      margin: 0;
    }
    
    .email-form {
      display: flex;
      gap: 1rem;
      max-width: 500px;
      margin: 2rem auto;
    }
    
    .email-form input {
      flex: 1;
      padding: 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
    }
    
    .email-form button {
      padding: 1rem 2rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .email-form button:hover {
      background: #e67e22;
      transform: translateY(-2px);
    }
    
    /* Step Wizard Styles */
    .calculator-section {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 3rem;
      display: none;
    }
    
    .calculator-section.active {
      display: block;
    }
    
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3rem;
      position: relative;
    }
    
    .progress-bar::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 2px;
      background: #e0e0e0;
      z-index: 1;
    }
    
    .progress-step {
      background: #e0e0e0;
      color: #666;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
    }
    
    .progress-step.active {
      background: var(--accent);
      color: white;
    }
    
    .progress-step.completed {
      background: var(--primary);
      color: white;
    }
    
    .step-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .step-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-group {
      margin-bottom: 2rem;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-dark);
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1rem;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--accent);
      outline: none;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    
    /* Checkbox Groups */
    .upgrade-options {
      display: grid;
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .upgrade-option {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .upgrade-option:hover {
      border-color: var(--accent);
      background: #f8f9fa;
    }
    
    .upgrade-option input[type="checkbox"] {
      margin-right: 1rem;
      transform: scale(1.2);
    }
    
    .upgrade-option.selected {
      border-color: var(--accent);
      background: #f0f8ff;
    }
    
    .upgrade-details {
      flex: 1;
    }
    
    .upgrade-title {
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 0.25rem;
    }
    
    .upgrade-subtitle {
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    .upgrade-rebate {
      font-weight: 600;
      color: var(--accent);
      margin-left: auto;
    }
    
    /* Conditional Fields */
    .conditional-fields {
      margin-top: 2rem;
      padding: 2rem;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
      display: none;
    }
    
    .conditional-fields.active {
      display: block;
      animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Navigation Buttons */
    .step-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 3rem;
      gap: 1rem;
    }
    
    .nav-btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 120px;
    }
    
    .nav-btn.prev-btn {
      background: #6c757d;
      color: white;
    }
    
    .nav-btn.next-btn {
      background: var(--primary);
      color: white;
    }
    
    .nav-btn:hover {
      transform: translateY(-2px);
    }
    
    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Results Section */
    .results-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 3rem;
      margin-top: 2rem;
      display: none;
    }
    
    .results-section.active {
      display: block;
    }
    
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    .result-card {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .result-card h3 {
      font-size: 1rem;
      color: var(--gray);
      margin-bottom: 0.5rem;
    }
    
    .result-card .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-dark);
    }
    
    .result-card.highlight {
      background: var(--accent);
      color: white;
    }
    
    .result-card.highlight h3 {
      color: white;
      opacity: 0.9;
    }
    
    .result-card.highlight .value {
      color: white;
    }
    
    .result-card.environmental {
      background: #28a745;
      color: white;
    }
    
    .result-card.environmental h3 {
      color: white;
      opacity: 0.9;
    }
    
    .result-card.environmental .value {
      color: white;
    }
    
    .rebate-breakdown {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      margin: 2rem 0;
    }
    
    .rebate-item {
      display: flex;
      justify-content: space-between;
      padding: 1rem 0;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .rebate-item:last-child {
      border-bottom: none;
    }
    
    .rebate-total {
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--primary-dark);
    }
    
    .environmental-impact {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      padding: 2rem;
      border-radius: 8px;
      margin: 2rem 0;
      text-align: center;
    }
    
    .environmental-impact h3 {
      color: white;
      margin-bottom: 1rem;
    }
    
    .impact-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .impact-stat {
      text-align: center;
    }
    
    .impact-value {
      font-size: 1.5rem;
      font-weight: 700;
      display: block;
    }
    
    .impact-label {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-top: 0.25rem;
    }
    
    .payback-explanation {
      background: #e8f4f8;
      padding: 1.5rem;
      border-radius: 8px;
      margin: 2rem 0;
      border-left: 4px solid var(--primary);
    }
    
    .payback-explanation h4 {
      color: var(--primary-dark);
      margin-bottom: 0.5rem;
    }
    
    .payback-explanation p {
      margin: 0;
      color: var(--gray);
      line-height: 1.5;
    }
    
    .pdf-btn {
      background: var(--accent);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 2rem;
    }
    
    .pdf-btn:hover {
      background: #e67e22;
      transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .email-form {
        flex-direction: column;
      }
      
      .calculator-section {
        padding: 2rem 1.5rem;
      }
      
      .progress-bar {
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .step-navigation {
        flex-direction: column;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
      }
      
      .impact-stats {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container header-container">
      <a href="/" class="logo">AI<span>Forester</span></a>
      <nav class="nav">
        <button class="mobile-menu-btn" aria-label="Toggle menu">
          <i class="fas fa-bars"></i>
        </button>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/projects/">Projects</a></li>
          <li><a href="/products/">Products</a></li>
          <li><a href="/services.html">Services</a></li>
          <li><a href="/learning/">Learning</a></li>
          <li><a href="/resources/">Resources</a></li>
          <li><a href="/#contact">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Page Header -->
  <section class="project-header">
    <div class="container">
      <h1>Rainwise ROI Calculator</h1>
      <p class="subtitle">Calculate your water savings, environmental impact, and discover all available RDN rebates</p>
    </div>
  </section>

  <!-- Main Content -->
  <section class="calculator-content">
    <div class="calculator-container">
      <!-- Email Gate -->
      <div id="emailGate" class="email-gate-section">
        <h2>ðŸŒŠ Maximize Your Impact: Water, Money & Environment</h2>
        <p>See your complete savings potential across all 6 RDN rebate programs plus environmental benefits.</p>
        
        <div class="benefits-grid">
          <div class="benefit-card">
            <i class="fas fa-tint"></i>
            <h3>Conserve Water</h3>
            <p>Save thousands of gallons annually</p>
          </div>
          <div class="benefit-card">
            <i class="fas fa-dollar-sign"></i>
            <h3>Get Up to $1000</h3>
            <p>All RDN rebate programs</p>
          </div>
          <div class="benefit-card">
            <i class="fas fa-leaf"></i>
            <h3>Environmental Impact</h3>
            <p>Reduce water footprint</p>
          </div>
          <div class="benefit-card">
            <i class="fas fa-file-pdf"></i>
            <h3>Personal Action Plan</h3>
            <p>Custom PDF with next steps</p>
          </div>
        </div>
        
        <form id="rainwiseEmailForm" class="email-form">
          <input type="email" id="rainwiseEmail" placeholder="Enter your email address" required>
          <button type="submit">Get Free Calculator</button>
        </form>
        
        <p style="font-size: 0.85rem; color: #666; margin-top: 1rem;">
          Complete analysis for RDN homeowners. Unsubscribe anytime.
        </p>
      </div>
      
      <!-- Multi-Step Calculator -->
      <div id="calculatorSection" class="calculator-section">
        <div class="progress-bar">
          <div class="progress-step active" data-step="1">1</div>
          <div class="progress-step" data-step="2">2</div>
          <div class="progress-step" data-step="3">3</div>
          <div class="progress-step" data-step="4">4</div>
        </div>
        
        <form id="rebateWizard">
          <!-- Step 1: Basic Property Info -->
          <div class="step-content active" data-step="1">
            <h2>Property Information</h2>
            <p>Let's start with some basic details about your property.</p>
            
            <div class="form-row">
              <div class="form-group">
                <label for="postalCode">Postal Code</label>
                <input type="text" id="postalCode" placeholder="V9R 5S5" required 
                       pattern="[VvCc][0-9][A-Za-z] ?[0-9][A-Za-z][0-9]">
                <small style="color: var(--gray);">Must be in RDN area to qualify for rebates</small>
              </div>
              
              <div class="form-group">
                <label for="currentIrrigation">Current Irrigation System</label>
                <select id="currentIrrigation" required>
                  <option value="">Select current system</option>
                  <option value="none">No irrigation system</option>
                  <option value="hose">Manual hose watering</option>
                  <option value="spray">In-ground spray system</option>
                  <option value="rotor">Rotor/sprinkler system</option>
                  <option value="drip">Already have drip irrigation</option>
                </select>
              </div>
            </div>
            
            <div class="form-group">
              <label for="irrigationArea">Total Garden/Lawn Area (sq ft)</label>
              <input type="number" id="irrigationArea" placeholder="e.g., 1500" required min="1">
            </div>
          </div>
          
          <!-- Step 2: Upgrade Selection -->
          <div class="step-content" data-step="2">
            <h2>Select Your Upgrades</h2>
            <p>Choose which improvements you're considering (select all that apply):</p>
            
            <div class="upgrade-options">
              <label class="upgrade-option" for="dripConversion">
                <input type="checkbox" id="dripConversion" name="upgrades" value="drip">
                <div class="upgrade-details">
                  <div class="upgrade-title">Drip Irrigation Conversion</div>
                  <div class="upgrade-subtitle">Convert existing spray zones to drip irrigation</div>
                </div>
                <div class="upgrade-rebate">Up to $400</div>
              </label>
              
              <label class="upgrade-option" for="mpRotators">
                <input type="checkbox" id="mpRotators" name="upgrades" value="rotators">
                <div class="upgrade-details">
                  <div class="upgrade-title">MP Rotator Nozzles</div>
                  <div class="upgrade-subtitle">Upgrade fixed spray heads to matched precipitation rotators</div>
                </div>
                <div class="upgrade-rebate">Up to $100</div>
              </label>
              
              <label class="upgrade-option" for="smartController">
                <input type="checkbox" id="smartController" name="upgrades" value="controller">
                <div class="upgrade-details">
                  <div class="upgrade-title">Rain Sensor / Smart Controller</div>
                  <div class="upgrade-subtitle">Add weather-based irrigation control</div>
                </div>
                <div class="upgrade-rebate">$75-$100</div>
              </label>
              
              <label class="upgrade-option" for="soilImprovements">
                <input type="checkbox" id="soilImprovements" name="upgrades" value="soil">
                <div class="upgrade-details">
                  <div class="upgrade-title">Soil Improvements</div>
                  <div class="upgrade-subtitle">Compost, mulch, or topsoil for water retention</div>
                </div>
                <div class="upgrade-rebate">Up to $100</div>
              </label>
              
              <label class="upgrade-option" for="rainwaterHarvesting">
                <input type="checkbox" id="rainwaterHarvesting" name="upgrades" value="rainwater">
                <div class="upgrade-details">
                  <div class="upgrade-title">Rainwater Harvesting</div>
                  <div class="upgrade-subtitle">Cistern system â‰¥4,565L with roof collection</div>
                </div>
                <div class="upgrade-rebate">Up to $1000</div>
              </label>
            </div>
          </div>
          
          <!-- Step 3: Detailed Information -->
          <div class="step-content" data-step="3">
            <h2>Project Details</h2>
            <p>Provide details for your selected upgrades:</p>
            
            <!-- Drip Conversion Details -->
            <div id="dripDetails" class="conditional-fields">
              <h3><i class="fas fa-tint"></i> Drip Irrigation Conversion</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="dripArea">Area to convert (sq ft)</label>
                  <input type="number" id="dripArea" placeholder="e.g., 800">
                </div>
                <div class="form-group">
                  <label for="dripCost">Estimated installation cost ($)</label>
                  <input type="number" id="dripCost" placeholder="e.g., 1200">
                </div>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="certifiedPro1"> 
                  Will be installed by IIABC-certified professional
                </label>
              </div>
            </div>
            
            <!-- MP Rotator Details -->
            <div id="rotatorDetails" class="conditional-fields">
              <h3><i class="fas fa-shower"></i> MP Rotator Nozzles</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="headCount">Number of spray heads to replace</label>
                  <input type="number" id="headCount" placeholder="e.g., 12">
                </div>
                <div class="form-group">
                  <label for="rotatorCost">Total cost ($)</label>
                  <input type="number" id="rotatorCost" placeholder="e.g., 300">
                </div>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="certifiedPro2"> 
                  Will be installed by certified professional
                </label>
              </div>
            </div>
            
            <!-- Smart Controller Details -->
            <div id="controllerDetails" class="conditional-fields">
              <h3><i class="fas fa-microchip"></i> Smart Controller / Rain Sensor</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="controllerType">Current controller type</label>
                  <select id="controllerType">
                    <option value="none">No controller (manual)</option>
                    <option value="basic">Basic timer</option>
                    <option value="smart">Already smart controller</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="controllerCost">Device cost ($)</label>
                  <input type="number" id="controllerCost" placeholder="e.g., 200">
                </div>
              </div>
              <div class="form-group">
                <label>
                  <input type="checkbox" id="addRainSensor"> 
                  Adding rain sensor
                </label>
              </div>
            </div>
            
            <!-- Soil Improvements Details -->
            <div id="soilDetails" class="conditional-fields">
              <h3><i class="fas fa-seedling"></i> Soil Improvements</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="materialType">Material type</label>
                  <select id="materialType">
                    <option value="mulch">Mulch</option>
                    <option value="compost">Compost</option>
                    <option value="topsoil">Topsoil</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="soilArea">Area to cover (sq ft)</label>
                  <input type="number" id="soilArea" placeholder="e.g., 500">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="soilDepth">Depth (inches)</label>
                  <input type="number" id="soilDepth" placeholder="e.g., 3" step="0.5">
                </div>
                <div class="form-group">
                  <label for="materialCost">Material cost ($)</label>
                  <input type="number" id="materialCost" placeholder="e.g., 150">
                </div>
              </div>
            </div>
            
            <!-- Rainwater Harvesting Details -->
            <div id="rainwaterDetails" class="conditional-fields">
              <h3><i class="fas fa-water"></i> Rainwater Harvesting</h3>
              <div class="form-row">
                <div class="form-group">
                  <label for="tankVolume">Tank volume (Liters)</label>
                  <input type="number" id="tankVolume" placeholder="e.g., 5000" min="4565">
                </div>
                <div class="form-group">
                  <label for="roofArea">Roof collection area (sq ft)</label>
                  <input type="number" id="roofArea" placeholder="e.g., 800" min="200">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="totalRainwaterCost">Total system cost ($)</label>
                  <input type="number" id="totalRainwaterCost" placeholder="e.g., 3000">
                </div>
                <div class="form-group">
                  <label>
                    <input type="checkbox" id="potableRated"> 
                    Potable-rated cistern
                  </label>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Step 4: Water Usage & Costs -->
          <div class="step-content" data-step="4">
            <h2>Water Usage & Costs</h2>
            <p>Help us calculate your savings potential:</p>
            
            <div class="form-row">
              <div class="form-group">
                <label for="waterCost">Water cost ($/1000 gallons)</label>
                <input type="number" id="waterCost" step="0.01" placeholder="3.50" value="3.50" required>
                <small style="color: var(--gray);">RDN average is $3.50 per 1000 gallons</small>
              </div>
              
              <div class="form-group">
                <label for="irrigationMonths">Months irrigating per year</label>
                <input type="number" id="irrigationMonths" min="1" max="12" placeholder="6" value="6" required>
              </div>
            </div>
            
            <div class="form-group">
              <label for="currentUsage">Current monthly water usage (gallons) - optional</label>
              <input type="number" id="currentUsage" placeholder="e.g., 2500">
              <small style="color: var(--gray);">Leave blank to use area-based estimates</small>
            </div>
          </div>
        </form>
        
        <!-- Navigation -->
        <div class="step-navigation">
          <button type="button" class="nav-btn prev-btn" id="prevBtn" disabled>
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <button type="button" class="nav-btn next-btn" id="nextBtn">
            Next <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>
      
      <!-- Results Section -->
      <div id="resultsSection" class="results-section">
        <h2>Your Complete Impact Analysis</h2>
        
        <div class="results-grid">
          <div class="result-card environmental">
            <h3>Annual Water Savings</h3>
            <div class="value" id="waterSavings">--</div>
          </div>
          
          <div class="result-card">
            <h3>Annual Cost Savings</h3>
            <div class="value" id="costSavings">--</div>
          </div>
          
          <div class="result-card highlight">
            <h3>Total RDN Rebates</h3>
            <div class="value" id="totalRebates">--</div>
          </div>
          
          <div class="result-card">
            <h3>Complete Payback Period</h3>
            <div class="value" id="paybackPeriod">--</div>
          </div>
        </div>
        
        <div class="payback-explanation">
          <h4><i class="fas fa-info-circle"></i> Understanding Your Payback</h4>
          <p><strong>Your payback period includes ongoing water savings!</strong> This calculation shows how quickly your investment pays for itself through the combination of upfront rebates plus annual water bill savings. The environmental benefits of water conservation continue for years beyond the payback period.</p>
        </div>
        
        <div class="environmental-impact">
          <h3><i class="fas fa-leaf"></i> Your Environmental Impact</h3>
          <p>Beyond the financial benefits, you're making a real difference for water conservation:</p>
          <div class="impact-stats">
            <div class="impact-stat">
              <span class="impact-value" id="lifetimeWaterSavings">--</span>
              <span class="impact-label">Gallons saved over 10 years</span>
            </div>
            <div class="impact-stat">
              <span class="impact-value" id="waterReduction">--</span>
              <span class="impact-label">% reduction in water use</span>
            </div>
            <div class="impact-stat">
              <span class="impact-value" id="equivalentHomes">--</span>
              <span class="impact-label">Equivalent homes' daily water</span>
            </div>
            <div class="impact-stat">
              <span class="impact-value" id="co2Equivalent">--</span>
              <span class="impact-label">lbs COâ‚‚ saved annually*</span>
            </div>
          </div>
          <small style="opacity: 0.8; font-size: 0.8rem;">*Energy savings from reduced water treatment and pumping</small>
        </div>
        
        <div class="rebate-breakdown">
          <h3>Rebate Breakdown</h3>
          <div id="rebateDetails"></div>
        </div>
        
        <button class="pdf-btn" id="generatePDF">
          <i class="fas fa-download"></i> Download Personal Action Plan (PDF)
        </button>
        
        <div style="margin-top: 2rem; padding: 1.5rem; background: #e8f4f8; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem;">Next Steps:</h4>
          <ol style="margin: 0; padding-left: 1.5rem;">
            <li>Review your personalized PDF action plan</li>
            <li>Apply for RDN pre-approval for eligible rebates</li>
            <li>Get quotes from IIABC-certified contractors</li>
            <li>Complete your upgrades and claim your rebates!</li>
            <li>Enjoy ongoing water savings and environmental benefits</li>
          </ol>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-container">
        <div class="footer-col">
          <h4>AI Forester</h4>
          <p>Bridging forestry expertise and artificial intelligence to create innovative solutions for environmental challenges.</p>
        </div>
        <div class="footer-col">
          <h4>Explore</h4>
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/projects/">Projects</a></li>
            <li><a href="/products/">Products</a></li>
            <li><a href="/services.html">Services</a></li>
            <li><a href="/learning/">Learning</a></li>
            <li><a href="/resources/">Resources</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Contact</h4>
          <ul>
            <li><a href="mailto:david@aiforester.com">david@aiforester.com</a></li>
            <li><a href="https://linkedin.com/in/david-beleznay-rpf-p-eng-75b4b511">LinkedIn</a></li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 AI Forester. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- EmailJS SDK -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  
  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize EmailJS
      emailjs.init("xicpYOZqOxz__Oh1J");
      
      // Global variables
      let currentStep = 1;
      const totalSteps = 4;
      const formData = {};
      
      // Mobile menu
      const menuBtn = document.querySelector('.mobile-menu-btn');
      const body = document.body;
      
      menuBtn.addEventListener('click', function() {
        body.classList.toggle('mobile-menu-open');
      });
      
      // Check if user already has access
      const hasRainwiseAccess = localStorage.getItem('aiforester_rainwise_access');
      if (hasRainwiseAccess) {
        document.getElementById('emailGate').style.display = 'none';
        document.getElementById('calculatorSection').classList.add('active');
      }
      
      // Email form submission
      const emailForm = document.getElementById('rainwiseEmailForm');
      emailForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('rainwiseEmail').value;
        const button = this.querySelector('button');
        const originalText = button.textContent;
        
        button.textContent = 'Processing...';
        button.disabled = true;
        
        try {
          await emailjs.send(
            "service_snup99l",
            "template_61o5oev",
            {
              from_email: email,
              date: new Date().toLocaleDateString(),
              time: new Date().toLocaleTimeString(),
              product: 'Enhanced Rainwise Calculator'
            }
          );
          
          localStorage.setItem('aiforester_rainwise_access', 'true');
          localStorage.setItem('aiforester_rainwise_email', email);
          
          document.getElementById('emailGate').style.display = 'none';
          document.getElementById('calculatorSection').classList.add('active');
          
          document.getElementById('calculatorSection').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
          
        } catch (error) {
          console.error('Error:', error);
          alert('There was an error. Please try again or contact david@aiforester.com');
          button.textContent = originalText;
          button.disabled = false;
        }
      });
      
      // Step wizard navigation
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
          currentStep--;
          updateStep();
        }
      });
      
      nextBtn.addEventListener('click', function() {
        if (validateCurrentStep()) {
          if (currentStep < totalSteps) {
            currentStep++;
            updateStep();
          } else {
            calculateResults();
          }
        }
      });
      
      // Update step display
      function updateStep() {
        // Update progress bar
        document.querySelectorAll('.progress-step').forEach((step, index) => {
          const stepNum = index + 1;
          step.classList.remove('active', 'completed');
          
          if (stepNum < currentStep) {
            step.classList.add('completed');
          } else if (stepNum === currentStep) {
            step.classList.add('active');
          }
        });
        
        // Update step content
        document.querySelectorAll('.step-content').forEach((content, index) => {
          const stepNum = index + 1;
          content.classList.remove('active');
          
          if (stepNum === currentStep) {
            content.classList.add('active');
          }
        });
        
        // Update navigation buttons
        prevBtn.disabled = currentStep === 1;
        
        if (currentStep === totalSteps) {
          nextBtn.textContent = 'Calculate Results';
          nextBtn.innerHTML = '<i class="fas fa-calculator"></i> Calculate Results';
        } else {
          nextBtn.innerHTML = 'Next <i class="fas fa-arrow-right"></i>';
        }
      }
      
      // Validate current step
      function validateCurrentStep() {
        const currentStepElement = document.querySelector(`.step-content[data-step="${currentStep}"]`);
        const requiredFields = currentStepElement.querySelectorAll('input[required], select[required]');
        
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            field.style.borderColor = '#dc3545';
            isValid = false;
          } else {
            field.style.borderColor = '#e0e0e0';
          }
        });
        
        // Special validation for postal code (RDN area)
        if (currentStep === 1) {
          const postalCode = document.getElementById('postalCode').value.trim().toUpperCase();
          if (postalCode && !isRDNPostalCode(postalCode)) {
            alert('This calculator is specifically for RDN (Regional District of Nanaimo) residents. Please verify your postal code.');
            return false;
          }
        }
        
        if (!isValid) {
          alert('Please fill in all required fields.');
        }
        
        return isValid;
      }
      
      // Check if postal code is in RDN area
      function isRDNPostalCode(code) {
        // RDN postal code prefixes
        const rdnPrefixes = ['V9R', 'V9S', 'V9T', 'V9P', 'V0R'];
        return rdnPrefixes.some(prefix => code.startsWith(prefix));
      }
      
      // Handle upgrade selection
      document.querySelectorAll('input[name="upgrades"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const option = this.closest('.upgrade-option');
          const detailsId = this.value + 'Details';
          const detailsElement = document.getElementById(detailsId);
          
          if (this.checked) {
            option.classList.add('selected');
            if (detailsElement) {
              detailsElement.classList.add('active');
            }
          } else {
            option.classList.remove('selected');
            if (detailsElement) {
              detailsElement.classList.remove('active');
            }
          }
        });
      });
      
      // Calculate results
      function calculateResults() {
        collectFormData();
        
        const results = {
          waterSavings: 0,
          costSavings: 0,
          totalRebates: 0,
          rebateBreakdown: {},
          paybackPeriod: 0,
          environmentalImpact: {}
        };
        
        // Calculate water savings based on current system and area
        const area = parseFloat(formData.irrigationArea) || 0;
        const waterCost = parseFloat(formData.waterCost) || 3.50;
        const months = parseInt(formData.irrigationMonths) || 6;
        
        // Water usage rates (gallons per sq ft per season)
        const usageRates = {
          none: 0,
          hose: 30,
          spray: 25,
          rotor: 20,
          drip: 12.5
        };
        
        const currentUsage = usageRates[formData.currentIrrigation] * area;
        const dripUsage = usageRates.drip * area;
        results.waterSavings = Math.max(0, currentUsage - dripUsage) * (months / 12);
        results.costSavings = results.waterSavings * (waterCost / 1000);
        
        // Calculate environmental impact
        results.environmentalImpact = {
          lifetimeWaterSavings: results.waterSavings * 10,
          waterReduction: currentUsage > 0 ? Math.round(((currentUsage - dripUsage) / currentUsage) * 100) : 0,
          equivalentHomes: Math.round(results.waterSavings / 80), // Average daily home usage ~80 gallons
          co2Equivalent: Math.round(results.waterSavings * 0.006) // ~6 lbs CO2 per 1000 gallons water processing
        };
        
        // Calculate rebates for each selected upgrade
        let totalProjectCost = 0;
        
        if (formData.upgrades.includes('drip')) {
          const rebate = calculateDripRebate();
          results.rebateBreakdown['Drip Irrigation Conversion'] = rebate;
          results.totalRebates += rebate;
          totalProjectCost += parseFloat(formData.dripCost) || 0;
        }
        
        if (formData.upgrades.includes('rotators')) {
          const rebate = calculateRotatorRebate();
          results.rebateBreakdown['MP Rotator Nozzles'] = rebate;
          results.totalRebates += rebate;
          totalProjectCost += parseFloat(formData.rotatorCost) || 0;
        }
        
        if (formData.upgrades.includes('controller')) {
          const rebate = calculateControllerRebate();
          results.rebateBreakdown['Smart Controller/Rain Sensor'] = rebate;
          results.totalRebates += rebate;
          totalProjectCost += parseFloat(formData.controllerCost) || 0;
        }
        
        if (formData.upgrades.includes('soil')) {
          const rebate = calculateSoilRebate();
          results.rebateBreakdown['Soil Improvements'] = rebate;
          results.totalRebates += rebate;
          totalProjectCost += parseFloat(formData.materialCost) || 0;
        }
        
        if (formData.upgrades.includes('rainwater')) {
          const rebate = calculateRainwaterRebate();
          results.rebateBreakdown['Rainwater Harvesting'] = rebate;
          results.totalRebates += rebate;
          totalProjectCost += parseFloat(formData.totalRainwaterCost) || 0;
        }
        
        // Check for combo bonus
        if (formData.upgrades.includes('drip') && formData.upgrades.includes('soil')) {
          results.rebateBreakdown['Combo Bonus'] = 100;
          results.totalRebates += 100;
        }
        
        // Calculate payback period
        const netCost = totalProjectCost - results.totalRebates;
        results.paybackPeriod = results.costSavings > 0 ? netCost / results.costSavings : 0;
        
        displayResults(results);
      }
      
      // Collect form data
      function collectFormData() {
        formData.postalCode = document.getElementById('postalCode').value;
        formData.currentIrrigation = document.getElementById('currentIrrigation').value;
        formData.irrigationArea = document.getElementById('irrigationArea').value;
        formData.waterCost = document.getElementById('waterCost').value;
        formData.irrigationMonths = document.getElementById('irrigationMonths').value;
        
        // Collect selected upgrades
        formData.upgrades = Array.from(document.querySelectorAll('input[name="upgrades"]:checked'))
                                .map(cb => cb.value);
        
        // Collect upgrade-specific data
        formData.dripArea = document.getElementById('dripArea').value;
        formData.dripCost = document.getElementById('dripCost').value;
        formData.certifiedPro1 = document.getElementById('certifiedPro1').checked;
        
        formData.headCount = document.getElementById('headCount').value;
        formData.rotatorCost = document.getElementById('rotatorCost').value;
        formData.certifiedPro2 = document.getElementById('certifiedPro2').checked;
        
        formData.controllerType = document.getElementById('controllerType').value;
        formData.controllerCost = document.getElementById('controllerCost').value;
        formData.addRainSensor = document.getElementById('addRainSensor').checked;
        
        formData.materialType = document.getElementById('materialType').value;
        formData.soilArea = document.getElementById('soilArea').value;
        formData.soilDepth = document.getElementById('soilDepth').value;
        formData.materialCost = document.getElementById('materialCost').value;
        
        formData.tankVolume = document.getElementById('tankVolume').value;
        formData.roofArea = document.getElementById('roofArea').value;
        formData.totalRainwaterCost = document.getElementById('totalRainwaterCost').value;
        formData.potableRated = document.getElementById('potableRated').checked;
      }
      
      // Individual rebate calculations
      function calculateDripRebate() {
        if (!formData.certifiedPro1) return 0;
        const cost = parseFloat(formData.dripCost) || 0;
        return Math.min(400, cost * 0.5);
      }
      
      function calculateRotatorRebate() {
        if (!formData.certifiedPro2) return 0;
        return 100; // Fixed rebate amount
      }
      
      function calculateControllerRebate() {
        const cost = parseFloat(formData.controllerCost) || 0;
        if (formData.addRainSensor) {
          return Math.min(100, cost * 0.5);
        } else {
          return Math.min(75, cost * 0.5);
        }
      }
      
      function calculateSoilRebate() {
        const cost = parseFloat(formData.materialCost) || 0;
        return Math.min(100, cost * 0.5);
      }
      
      function calculateRainwaterRebate() {
        const volume = parseFloat(formData.tankVolume) || 0;
        const roofArea = parseFloat(formData.roofArea) || 0;
        const cost = parseFloat(formData.totalRainwaterCost) || 0;
        
        if (volume < 4565 || roofArea < 200 || !formData.potableRated) {
          return 0;
        }
        
        return Math.min(1000, cost * 0.3); // Up to $700 for tank + $300 for other components
      }
      
      // Display results
      function displayResults(results) {
        document.getElementById('waterSavings').textContent = 
          Math.round(results.waterSavings).toLocaleString() + ' gal/year';
        document.getElementById('costSavings').textContent = 
          '$' + Math.round(results.costSavings).toLocaleString();
        document.getElementById('totalRebates').textContent = 
          '$' + Math.round(results.totalRebates).toLocaleString();
        document.getElementById('paybackPeriod').textContent = 
          results.paybackPeriod < 15 ? results.paybackPeriod.toFixed(1) + ' years' : '15+ years';
        
        // Display environmental impact
        document.getElementById('lifetimeWaterSavings').textContent = 
          Math.round(results.environmentalImpact.lifetimeWaterSavings).toLocaleString();
        document.getElementById('waterReduction').textContent = 
          results.environmentalImpact.waterReduction + '%';
        document.getElementById('equivalentHomes').textContent = 
          results.environmentalImpact.equivalentHomes.toLocaleString();
        document.getElementById('co2Equivalent').textContent = 
          results.environmentalImpact.co2Equivalent.toLocaleString();
        
        // Display rebate breakdown
        const breakdownElement = document.getElementById('rebateDetails');
        breakdownElement.innerHTML = '';
        
        Object.entries(results.rebateBreakdown).forEach(([program, amount]) => {
          const div = document.createElement('div');
          div.className = 'rebate-item';
          div.innerHTML = `
            <span>${program}</span>
            <span>$${Math.round(amount).toLocaleString()}</span>
          `;
          breakdownElement.appendChild(div);
        });
        
        // Add total
        const totalDiv = document.createElement('div');
        totalDiv.className = 'rebate-item rebate-total';
        totalDiv.innerHTML = `
          <span>Total Rebates</span>
          <span>$${Math.round(results.totalRebates).toLocaleString()}</span>
        `;
        breakdownElement.appendChild(totalDiv);
        
        // Show results section
        document.getElementById('calculatorSection').style.display = 'none';
        document.getElementById('resultsSection').classList.add('active');
        
        document.getElementById('resultsSection').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
        
        // Store results for PDF generation
        window.calculationResults = results;
      }
      
      // PDF Generation
      document.getElementById('generatePDF').addEventListener('click', function() {
        generatePDF();
      });
      
      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Title
        doc.setFontSize(20);
        doc.text('Your Personal RDN Rebate & Water Conservation Plan', 20, 30);
        
        // Property info
        doc.setFontSize(12);
        doc.text(`Property: ${formData.postalCode}`, 20, 50);
        doc.text(`Current System: ${formData.currentIrrigation}`, 20, 60);
        doc.text(`Area: ${formData.irrigationArea} sq ft`, 20, 70);
        
        // Results summary
        doc.setFontSize(14);
        doc.text('Financial Summary', 20, 90);
        doc.setFontSize(12);
        doc.text(`Annual Water Savings: ${document.getElementById('waterSavings').textContent}`, 20, 105);
        doc.text(`Annual Cost Savings: ${document.getElementById('costSavings').textContent}`, 20, 115);
        doc.text(`Total Available Rebates: ${document.getElementById('totalRebates').textContent}`, 20, 125);
        doc.text(`Complete Payback Period: ${document.getElementById('paybackPeriod').textContent}`, 20, 135);
        
        // Environmental impact
        doc.setFontSize(14);
        doc.text('Environmental Impact (10-Year Projection)', 20, 155);
        doc.setFontSize(12);
        doc.text(`Water Saved: ${document.getElementById('lifetimeWaterSavings').textContent} gallons`, 20, 170);
        doc.text(`Water Use Reduction: ${document.getElementById('waterReduction').textContent}`, 20, 180);
        doc.text(`COâ‚‚ Savings: ${document.getElementById('co2Equivalent').textContent} lbs annually`, 20, 190);
        
        // Rebate breakdown
        doc.setFontSize(14);
        doc.text('Rebate Breakdown', 20, 210);
        let yPos = 225;
        
        Object.entries(window.calculationResults.rebateBreakdown).forEach(([program, amount]) => {
          doc.setFontSize(12);
          doc.text(`${program}: $${Math.round(amount).toLocaleString()}`, 25, yPos);
          yPos += 10;
        });
        
        // Next steps
        doc.setFontSize(14);
        doc.text('Next Steps', 20, yPos + 20);
        doc.setFontSize(12);
        yPos += 35;
        
        const steps = [
          '1. Apply for RDN pre-approval for eligible rebates',
          '2. Get quotes from IIABC-certified contractors',
          '3. Complete installations with proper documentation',
          '4. Submit rebate applications within 90 days',
          '5. Enjoy ongoing water & money savings plus environmental benefits!'
        ];
        
        steps.forEach(step => {
          doc.text(step, 25, yPos);
          yPos += 10;
        });
        
        // Footer
        doc.setFontSize(10);
        doc.text('Generated by AI Forester Rainwise Calculator', 20, 280);
        doc.text(`Created: ${new Date().toLocaleDateString()}`, 20, 290);
        
        // Save the PDF
        doc.save('RDN-Water-Conservation-Action-Plan.pdf');
      }
    });
  </script>
</body>
</html>