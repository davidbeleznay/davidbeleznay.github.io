<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RDN Water Conservation ROI Calculator & Rebate Application Helper | AI Forester</title>
  <meta name="description" content="Calculate water savings, ROI, and payback periods for RDN rebate programs. Prepare your complete Irrigation & Soil Improvements application with personalized financial analysis.">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f0f5f3;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: linear-gradient(135deg, #2c5530 0%, #3a7f42 100%);
      color: white;
      padding: 60px 20px;
      text-align: center;
      margin-bottom: 40px;
      border-radius: 0 0 20px 20px;
    }
    
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .subtitle {
      font-size: 1.2em;
      opacity: 0.95;
      margin-bottom: 20px;
    }
    
    .badges {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .badge {
      background: rgba(255,255,255,0.2);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
    }
    
    /* ROI Showcase Section */
    .roi-showcase {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border-left: 5px solid #e74c3c;
    }
    
    .roi-showcase h2 {
      color: #2c5530;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.8em;
    }
    
    .roi-intro {
      background: #e8f5ea;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .roi-intro h3 {
      color: #155724;
      margin-bottom: 10px;
    }
    
    .roi-intro p {
      color: #155724;
      margin-bottom: 10px;
    }
    
    .water-rates-info {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .water-rates-info h4 {
      color: #856404;
      margin-bottom: 15px;
    }
    
    .rate-tier {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #ffeaa7;
    }
    
    .rate-tier:last-child {
      border-bottom: none;
    }
    
    .tier-name {
      font-weight: bold;
    }
    
    .tier-rate {
      color: #e74c3c;
      font-weight: bold;
    }
    
    .rebate-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .rebate-option {
      background: rgba(255,255,255,0.9);
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e0e0e0;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .rebate-option:hover, .rebate-option.selected {
      border-color: #3a7f42;
      background: #f9fdfb;
    }
    
    .rebate-amount {
      font-size: 1.5em;
      font-weight: bold;
      color: #e74c3c;
      display: block;
      margin-bottom: 8px;
    }
    
    .rebate-title {
      font-weight: 600;
      color: #2c5530;
      margin-bottom: 8px;
    }
    
    .rebate-description {
      font-size: 0.9em;
      color: #666;
    }
    
    .calculator-wrapper {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      padding: 40px;
      margin-bottom: 40px;
    }
    
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      position: relative;
    }
    
    .progress-bar::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e0e0e0;
      z-index: 0;
    }
    
    .progress-step {
      position: relative;
      z-index: 1;
      text-align: center;
      flex: 1;
    }
    
    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e0e0e0;
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      transition: all 0.3s ease;
    }
    
    .progress-step.active .step-circle,
    .progress-step.completed .step-circle {
      background: #3a7f42;
    }
    
    .step-label {
      font-size: 0.85em;
      color: #666;
    }
    
    .form-section {
      display: none;
      animation: fadeIn 0.3s ease-in;
    }
    
    .form-section.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c5530;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s ease;
    }
    
    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #3a7f42;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .help-text {
      font-size: 0.85em;
      color: #666;
      margin-top: 5px;
    }
    
    .water-usage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .usage-input {
      display: flex;
      flex-direction: column;
    }
    
    .usage-analysis {
      background: #e8f5ea;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #3a7f42;
    }
    
    .usage-analysis h4 {
      color: #2c5530;
      margin-bottom: 15px;
    }
    
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .analysis-metric {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .metric-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #2c5530;
    }
    
    .metric-label {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }
    
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: start;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .checkbox-item:hover {
      border-color: #3a7f42;
      background: #f9fdfb;
    }
    
    .checkbox-item input[type="checkbox"] {
      margin-right: 12px;
      margin-top: 3px;
      cursor: pointer;
    }
    
    .checkbox-content {
      flex: 1;
    }
    
    .checkbox-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .checkbox-description {
      font-size: 0.9em;
      color: #666;
    }
    
    .rebate-amount-inline {
      color: #e74c3c;
      font-weight: bold;
    }
    
    .upgrade-details {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background: #f9fdfb;
      border-radius: 8px;
      border: 1px solid #e0f0e5;
    }
    
    .soil-calculator {
      background: #f0f8ff;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border: 1px solid #b3d9ff;
    }
    
    .soil-calculator h4 {
      color: #1e5ba8;
      margin-bottom: 15px;
    }
    
    .soil-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .soil-result {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .soil-amount {
      font-size: 1.2em;
      font-weight: bold;
      color: #2c5530;
    }
    
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 20px;
    }
    
    .btn {
      padding: 14px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: #3a7f42;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2c5530;
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }
    
    .btn-secondary:hover {
      background: #d0d0d0;
    }
    
    .btn-success {
      background: #4CAF50;
      color: white;
    }
    
    .btn-success:hover {
      background: #45a049;
    }
    
    .results-section {
      display: none;
      margin-top: 40px;
    }
    
    .results-section.active {
      display: block;
    }
    
    .roi-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .roi-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .roi-card:hover {
      transform: translateY(-2px);
    }
    
    .roi-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    
    .roi-value {
      font-size: 2em;
      font-weight: bold;
      color: #3a7f42;
      margin: 10px 0;
    }
    
    .roi-label {
      color: #666;
      font-size: 0.9em;
    }
    
    .payback-analysis {
      background: #fff3cd;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 30px;
      border: 1px solid #ffeaa7;
    }
    
    .payback-analysis h3 {
      color: #856404;
      margin-bottom: 15px;
    }
    
    .payback-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .payback-table th,
    .payback-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .payback-table th {
      background: #f8f9fa;
      font-weight: bold;
      color: #2c5530;
    }
    
    .payback-table .total-row {
      background: #e8f5ea;
      font-weight: bold;
    }
    
    .application-preview {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      border: 2px solid #3a7f42;
    }
    
    .application-preview h3 {
      color: #2c5530;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .form-preview {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      white-space: pre-line;
      margin-bottom: 20px;
    }
    
    .checklist {
      background: #d1ecf1;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #bee5eb;
      margin-bottom: 20px;
    }
    
    .checklist h4 {
      color: #0c5460;
      margin-bottom: 15px;
    }
    
    .checklist-item {
      display: flex;
      align-items: start;
      margin: 10px 0;
      color: #0c5460;
    }
    
    .checklist-item::before {
      content: "☐ ";
      margin-right: 8px;
      font-weight: bold;
    }
    
    .environmental-impact {
      background: linear-gradient(135deg, #e8f5ea 0%, #d4f1d9 100%);
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    
    .environmental-impact h3 {
      color: #2c5530;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .impact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .impact-item {
      background: rgba(255, 255, 255, 0.8);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    
    .impact-value {
      font-size: 1.8em;
      font-weight: bold;
      color: #2c5530;
    }
    
    .impact-label {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }
    
    .cta-section {
      background: linear-gradient(135deg, #3a7f42 0%, #2c5530 100%);
      color: white;
      padding: 40px;
      border-radius: 12px;
      text-align: center;
      margin-top: 40px;
    }
    
    .cta-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .calculator-wrapper {
        padding: 20px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .badges {
        flex-direction: column;
        align-items: center;
      }
      
      .navigation-buttons {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .rebate-options {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .water-usage-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  
  <!-- jsPDF for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>RDN Water Conservation ROI Calculator</h1>
      <p class="subtitle">Complete Financial Analysis & Rebate Application Helper</p>
      <div class="badges">
        <span class="badge">💰 Up to $875 in Rebates</span>
        <span class="badge">📊 ROI & Payback Analysis</span>
        <span class="badge">📋 Form Pre-filled</span>
        <span class="badge">💧 Water Savings Calculator</span>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- ROI Analysis Introduction -->
    <div class="roi-showcase">
      <h2>🎯 Complete Return on Investment Analysis</h2>
      <div class="roi-intro">
        <h3>What This ROI Calculator Does</h3>
        <p>✅ Analyzes your water consumption baseline using RDN seasonal patterns</p>
        <p>✅ Calculates potential water savings for each upgrade scenario</p>
        <p>✅ Applies Nanaimo's tiered water rates to determine actual cost savings</p>
        <p>✅ Computes payback periods based on net project costs after rebates</p>
        <p>✅ Provides 10-year financial projections and environmental impact</p>
      </div>
      
      <div class="water-rates-info">
        <h4>💰 Nanaimo Water Rates (2025) - Tiered Pricing Structure</h4>
        <div class="rate-tier">
          <span class="tier-name">Base Rate (Daily):</span>
          <span class="tier-rate">$1.06/day</span>
        </div>
        <div class="rate-tier">
          <span class="tier-name">Tier 1 (0-110 gal/day):</span>
          <span class="tier-rate">$0.00223/gallon</span>
        </div>
        <div class="rate-tier">
          <span class="tier-name">Tier 2 (110-220 gal/day):</span>
          <span class="tier-rate">$0.00555/gallon</span>
        </div>
        <div class="rate-tier">
          <span class="tier-name">Tier 3 (220-330 gal/day):</span>
          <span class="tier-rate">$0.00971/gallon</span>
        </div>
        <div class="rate-tier">
          <span class="tier-name">Tier 4 (330+ gal/day):</span>
          <span class="tier-rate">$0.01703/gallon</span>
        </div>
        <p style="margin-top: 15px; font-style: italic; color: #856404;">Higher usage = Higher savings potential from conservation!</p>
      </div>
      
      <div class="rebate-options">
        <div class="rebate-option">
          <span class="rebate-amount">5-12 Years</span>
          <div class="rebate-title">Typical Payback Period</div>
          <div class="rebate-description">Most upgrades pay for themselves through water bill savings</div>
        </div>
        <div class="rebate-option">
          <span class="rebate-amount">20-50%</span>
          <div class="rebate-title">Water Use Reduction</div>
          <div class="rebate-description">Potential annual outdoor water savings</div>
        </div>
        <div class="rebate-option">
          <span class="rebate-amount">Dec 15, 2025</span>
          <div class="rebate-title">Program Deadline</div>
          <div class="rebate-description">All work must be completed by this date</div>
        </div>
      </div>
    </div>

    <div class="calculator-wrapper" id="calculatorSection">
      <!-- Progress Bar -->
      <div class="progress-bar">
        <div class="progress-step active" id="step1">
          <div class="step-circle">1</div>
          <div class="step-label">Property & Contact</div>
        </div>
        <div class="progress-step" id="step2">
          <div class="step-circle">2</div>
          <div class="step-label">Water Usage Baseline</div>
        </div>
        <div class="progress-step" id="step3">
          <div class="step-circle">3</div>
          <div class="step-label">Select Upgrades</div>
        </div>
        <div class="progress-step" id="step4">
          <div class="step-circle">4</div>
          <div class="step-label">ROI Analysis</div>
        </div>
      </div>

      <!-- Step 1: Property Owner Information -->
      <div class="form-section active" id="section1">
        <h2>Property Owner Information</h2>
        <p class="help-text">This information will be used to pre-fill your RDN application form.</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="fullName">Full Name (Property Owner)</label>
            <input type="text" id="fullName" placeholder="John Smith">
          </div>
          
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="john.smith@email.com">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="phoneMain">Phone Number (Main)</label>
            <input type="tel" id="phoneMain" placeholder="250-555-0123">
          </div>
          
          <div class="form-group">
            <label for="phoneAlt">Phone Number (Alternate)</label>
            <input type="tel" id="phoneAlt" placeholder="250-555-0456">
          </div>
        </div>
        
        <div class="form-group">
          <label for="propertyAddress">RDN Property Address</label>
          <input type="text" id="propertyAddress" placeholder="123 Main Street">
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="city">City/Town</label>
            <input type="text" id="city" placeholder="Nanaimo">
          </div>
          
          <div class="form-group">
            <label for="postalCode">Postal Code</label>
            <input type="text" id="postalCode" placeholder="V9S 1A1" maxlength="7">
          </div>
        </div>
        
        <div class="form-group">
          <label for="mailingAddress">Mailing Address (if different)</label>
          <input type="text" id="mailingAddress" placeholder="Leave blank if same as property address">
        </div>
        
        <div class="navigation-buttons">
          <div></div>
          <button class="btn btn-primary" onclick="nextStep(1)">Next: Water Usage Analysis →</button>
        </div>
      </div>

      <!-- Step 2: Water Usage Baseline -->
      <div class="form-section" id="section2">
        <h2>Water Usage Baseline Analysis</h2>
        <p class="help-text">Enter your recent water usage to establish your consumption baseline for ROI calculations.</p>
        
        <div class="form-group">
          <label for="irrigatedArea">Total Irrigated Area (sq ft)</label>
          <input type="number" id="irrigatedArea" placeholder="2000" min="0" onchange="updateUsageAnalysis()">
          <p class="help-text">Include all lawn and garden areas you water</p>
        </div>
        
        <div class="form-group">
          <label for="irrigationMonths">Months of Irrigation per Year</label>
          <input type="number" id="irrigationMonths" placeholder="6" min="1" max="12" onchange="updateUsageAnalysis()">
          <p class="help-text">Typically 5-7 months in BC</p>
        </div>
        
        <h3>Recent Water Bills (Optional but Recommended)</h3>
        <p class="help-text">Enter usage from your last few bills for personalized analysis. Leave blank to use regional averages.</p>
        
        <div class="water-usage-grid">
          <div class="usage-input">
            <label for="usage1">Winter 2024-25 (gallons)</label>
            <input type="number" id="usage1" placeholder="e.g., 8,000" min="0" onchange="updateUsageAnalysis()">
          </div>
          <div class="usage-input">
            <label for="usage2">Fall 2024 (gallons)</label>
            <input type="number" id="usage2" placeholder="e.g., 12,000" min="0" onchange="updateUsageAnalysis()">
          </div>
          <div class="usage-input">
            <label for="usage3">Summer 2024 (gallons)</label>
            <input type="number" id="usage3" placeholder="e.g., 20,000" min="0" onchange="updateUsageAnalysis()">
          </div>
          <div class="usage-input">
            <label for="usage4">Spring 2024 (gallons)</label>
            <input type="number" id="usage4" placeholder="e.g., 15,000" min="0" onchange="updateUsageAnalysis()">
          </div>
        </div>
        
        <div class="usage-analysis" id="usageAnalysis" style="display: none;">
          <h4>📊 Your Water Consumption Analysis</h4>
          <div class="analysis-grid">
            <div class="analysis-metric">
              <div class="metric-value" id="avgDailyUsage">0</div>
              <div class="metric-label">Average Daily Usage</div>
            </div>
            <div class="analysis-metric">
              <div class="metric-value" id="seasonalPeak">0</div>
              <div class="metric-label">Summer Peak Factor</div>
            </div>
            <div class="analysis-metric">
              <div class="metric-value" id="outdoorUse">0%</div>
              <div class="metric-label">Estimated Outdoor Use</div>
            </div>
            <div class="analysis-metric">
              <div class="metric-value" id="currentTier">Tier 1</div>
              <div class="metric-label">Current Rate Tier</div>
            </div>
            <div class="analysis-metric">
              <div class="metric-value" id="annualCost">$0</div>
              <div class="metric-label">Estimated Annual Water Cost</div>
            </div>
            <div class="analysis-metric">
              <div class="metric-value" id="savingsPotential">High</div>
              <div class="metric-label">Conservation Potential</div>
            </div>
          </div>
        </div>
        
        <div class="navigation-buttons">
          <button class="btn btn-secondary" onclick="previousStep(2)">← Back</button>
          <button class="btn btn-primary" onclick="nextStep(2)">Next: Select Upgrades →</button>
        </div>
      </div>

      <!-- Step 3: Rebate Selection -->
      <div class="form-section" id="section3">
        <h2>Select Your Water-Saving Upgrades</h2>
        <p class="help-text">Choose the upgrades you want to analyze for ROI and include in your rebate application.</p>
        
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="rainSensor" name="rebates" value="rainSensor" onchange="toggleUpgradeDetails('rainSensor')">
            <div class="checkbox-content">
              <div class="checkbox-title">Rain Sensor <span class="rebate-amount-inline">($75 rebate)</span></div>
              <div class="checkbox-description">Automatically shuts off irrigation when raining • 10-15% water savings</div>
            </div>
          </div>
          
          <div class="checkbox-item">
            <input type="checkbox" id="smartController" name="rebates" value="smartController" onchange="toggleUpgradeDetails('smartController')">
            <div class="checkbox-content">
              <div class="checkbox-title">Smart Controller <span class="rebate-amount-inline">($100 rebate)</span></div>
              <div class="checkbox-description">Weather-based irrigation control • 20-40% water savings</div>
            </div>
          </div>
          
          <div class="checkbox-item">
            <input type="checkbox" id="dripConversion" name="rebates" value="dripConversion" onchange="toggleUpgradeDetails('dripConversion')">
            <div class="checkbox-content">
              <div class="checkbox-title">Drip Irrigation Conversion <span class="rebate-amount-inline">($400 rebate)</span></div>
              <div class="checkbox-description">Convert sprinklers to drip • 30-50% water savings on converted areas</div>
            </div>
          </div>
          
          <div class="checkbox-item">
            <input type="checkbox" id="mpRotators" name="rebates" value="mpRotators" onchange="toggleUpgradeDetails('mpRotators')">
            <div class="checkbox-content">
              <div class="checkbox-title">MP Rotator Nozzles <span class="rebate-amount-inline">($100 rebate)</span></div>
              <div class="checkbox-description">High-efficiency matched precipitation nozzles • 20-30% water savings</div>
            </div>
          </div>
          
          <div class="checkbox-item">
            <input type="checkbox" id="soilImprovements" name="rebates" value="soilImprovements" onchange="toggleUpgradeDetails('soilImprovements')">
            <div class="checkbox-content">
              <div class="checkbox-title">Soil Improvements <span class="rebate-amount-inline">(50% of costs, max $100)</span></div>
              <div class="checkbox-description">Quality topsoil, compost, or organic mulch • 25% less watering needed</div>
            </div>
          </div>
          
          <div class="checkbox-item" style="background: #e8f5ea; border-color: #4CAF50;">
            <input type="checkbox" id="comboBonus" name="rebates" value="comboBonus" disabled>
            <div class="checkbox-content">
              <div class="checkbox-title">🎉 Combo Bonus <span class="rebate-amount-inline">(+$100)</span></div>
              <div class="checkbox-description">Automatically applied when you do both irrigation upgrades AND soil improvements</div>
            </div>
          </div>
        </div>
        
        <!-- Upgrade Details Sections -->
        <div class="upgrade-details" id="rainSensorDetails">
          <h3>🌧️ Rain Sensor Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="rainSensorCost">Estimated Cost ($)</label>
              <input type="number" id="rainSensorCost" placeholder="100" min="0" value="100">
            </div>
            <div class="form-group">
              <label for="rainSensorSavings">Expected Water Savings (%)</label>
              <input type="number" id="rainSensorSavings" placeholder="15" min="5" max="30" value="15">
            </div>
          </div>
        </div>
        
        <div class="upgrade-details" id="smartControllerDetails">
          <h3>🤖 Smart Controller Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="controllerCost">Estimated Cost ($)</label>
              <input type="number" id="controllerCost" placeholder="250" min="0" value="250">
            </div>
            <div class="form-group">
              <label for="controllerSavings">Expected Water Savings (%)</label>
              <input type="number" id="controllerSavings" placeholder="30" min="10" max="50" value="30">
            </div>
          </div>
        </div>
        
        <div class="upgrade-details" id="dripConversionDetails">
          <h3>💧 Drip Irrigation Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="dripArea">Area to Convert (sq ft)</label>
              <input type="number" id="dripArea" placeholder="1000" min="0">
            </div>
            <div class="form-group">
              <label for="dripCost">Estimated Cost ($)</label>
              <input type="number" id="dripCost" placeholder="800" min="0" value="800">
            </div>
          </div>
          <div class="form-group">
            <label for="dripSavings">Expected Water Savings on Converted Area (%)</label>
            <input type="number" id="dripSavings" placeholder="40" min="20" max="60" value="40">
          </div>
          <div class="form-group">
            <label for="irrigationDescription">Description of irrigation upgrade(s)</label>
            <textarea id="irrigationDescription" placeholder="Describe what you plan to upgrade (e.g., 'Install smart controller to replace existing timer controller for 6-zone system in front and back yard')"></textarea>
          </div>
        </div>
        
        <div class="upgrade-details" id="mpRotatorsDetails">
          <h3>🔄 MP Rotator Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="rotatorCost">Estimated Cost ($)</label>
              <input type="number" id="rotatorCost" placeholder="200" min="0" value="200">
            </div>
            <div class="form-group">
              <label for="rotatorSavings">Expected Water Savings (%)</label>
              <input type="number" id="rotatorSavings" placeholder="25" min="15" max="40" value="25">
            </div>
          </div>
        </div>
        
        <div class="upgrade-details" id="soilImprovementsDetails">
          <h3>🌱 Soil Improvements Details</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="applicationArea">Application Area (sq ft)</label>
              <input type="number" id="applicationArea" placeholder="500" min="0" onchange="calculateSoilAmounts()">
            </div>
            <div class="form-group">
              <label for="applicationDepth">Application Type</label>
              <select id="applicationDepth" onchange="calculateSoilAmounts()">
                <option value="">Select application type</option>
                <option value="garden">Garden Beds (2 inch depth)</option>
                <option value="lawn">Lawn Topdressing (1/4 inch depth)</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="soilCost">Estimated Material Cost ($)</label>
            <input type="number" id="soilCost" placeholder="200" min="0" value="200">
          </div>
          
          <div class="form-group">
            <label for="soilSavings">Expected Water Savings (%)</label>
            <input type="number" id="soilSavings" placeholder="25" min="10" max="40" value="25">
          </div>
          
          <div class="soil-calculator" id="soilCalculator" style="display: none;">
            <h4>📊 Required Soil Amendment (Based on RDN Table)</h4>
            <div class="soil-grid">
              <div class="soil-result">
                <div class="soil-amount" id="bagsNeeded">0 bags</div>
                <div>28-Litre Bags</div>
              </div>
              <div class="soil-result">
                <div class="soil-amount" id="cubicYards">0 cubic yards</div>
                <div>Bulk Quantity</div>
              </div>
              <div class="soil-result">
                <div class="soil-amount" id="estimatedSoilCost">$0 - $0</div>
                <div>Estimated Cost</div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label for="soilDescription">Description of soil improvement(s)</label>
            <textarea id="soilDescription" placeholder="Describe your soil improvement plans (e.g., 'Add 2 inches of quality compost to 500 sq ft of garden beds to improve soil health and water retention')"></textarea>
          </div>
        </div>
        
        <div class="navigation-buttons">
          <button class="btn btn-secondary" onclick="previousStep(3)">← Back</button>
          <button class="btn btn-success" onclick="calculateROI()">Calculate ROI & Generate Application →</button>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div class="results-section" id="resultsSection">
      <h2>📊 Complete ROI Analysis & RDN Application</h2>
      
      <!-- ROI Results Cards -->
      <div class="roi-results">
        <div class="roi-card">
          <div class="roi-icon">💧</div>
          <div class="roi-value" id="waterSavings">0</div>
          <div class="roi-label">Gallons Saved Annually</div>
        </div>
        
        <div class="roi-card">
          <div class="roi-icon">💰</div>
          <div class="roi-value" id="costSavings">$0</div>
          <div class="roi-label">Annual Cost Savings</div>
        </div>
        
        <div class="roi-card">
          <div class="roi-icon">🎯</div>
          <div class="roi-value" id="totalRebates">$0</div>
          <div class="roi-label">Total Rebates</div>
        </div>
        
        <div class="roi-card">
          <div class="roi-icon">📅</div>
          <div class="roi-value" id="paybackPeriod">0</div>
          <div class="roi-label">Payback Period</div>
        </div>
        
        <div class="roi-card">
          <div class="roi-icon">📈</div>
          <div class="roi-value" id="roiPercentage">0%</div>
          <div class="roi-label">5-Year ROI</div>
        </div>
        
        <div class="roi-card">
          <div class="roi-icon">🏠</div>
          <div class="roi-value" id="propertyValue">+$0</div>
          <div class="roi-label">Est. Property Value Increase</div>
        </div>
      </div>
      
      <!-- Detailed ROI Analysis Table -->
      <div class="payback-analysis">
        <h3>💡 Detailed Financial Analysis</h3>
        <table class="payback-table">
          <thead>
            <tr>
              <th>Upgrade</th>
              <th>Cost</th>
              <th>Rebate</th>
              <th>Net Cost</th>
              <th>Annual Savings</th>
              <th>Payback</th>
            </tr>
          </thead>
          <tbody id="paybackTableBody">
            <!-- Populated by JavaScript -->
          </tbody>
        </table>
      </div>
      
      <!-- Environmental Impact -->
      <div class="environmental-impact">
        <h3>🌍 Environmental Impact (10-Year Projection)</h3>
        <div class="impact-grid">
          <div class="impact-item">
            <div class="impact-value" id="lifetimeWaterSavings">0</div>
            <div class="impact-label">Gallons of Water Saved</div>
          </div>
          <div class="impact-item">
            <div class="impact-value" id="waterReduction">0%</div>
            <div class="impact-label">Total Water Use Reduction</div>
          </div>
          <div class="impact-item">
            <div class="impact-value" id="co2Savings">0</div>
            <div class="impact-label">lbs CO₂ Saved Annually</div>
          </div>
          <div class="impact-item">
            <div class="impact-value" id="lifetimeSavings">$0</div>
            <div class="impact-label">10-Year Cost Savings</div>
          </div>
        </div>
      </div>
      
      <!-- RDN Application Preview -->
      <div class="application-preview">
        <h3>📋 Your Pre-filled RDN Application</h3>
        <div class="form-preview" id="applicationPreview"></div>
        
        <div class="checklist">
          <h4>📋 Implementation & Submission Checklist</h4>
          <div id="submissionChecklist"></div>
        </div>
      </div>
      
      <div class="cta-section">
        <h2>Your Water Conservation Investment Plan is Ready!</h2>
        <p>Complete ROI analysis shows strong returns. Download your application and start saving!</p>
        <div class="cta-buttons">
          <button class="btn btn-primary" id="downloadApplication">📄 Download Complete Analysis (PDF)</button>
          <a href="https://www.rdn.bc.ca/sites/default/files/inline-files/2025%20I%26S%20Pre-approval%20Application%20Form.pdf" target="_blank" class="btn btn-secondary">📋 Download Official Form</a>
          <a href="https://www.irrigationbc.com" target="_blank" class="btn btn-secondary">🔍 Find IIABC Professionals</a>
          <button class="btn btn-secondary" onclick="location.reload()">🔄 Start New Analysis</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentStep = 1;
    let formData = {};
    let selectedRebates = [];
    let waterBaseline = {};
    let roiResults = {};
    
    // Nanaimo Water Rate Tiers (2025)
    const waterRates = {
      baseRate: 1.06, // per day
      tiers: [
        { min: 0, max: 110, rate: 0.00223 },
        { min: 110, max: 220, rate: 0.00555 },
        { min: 220, max: 330, rate: 0.00971 },
        { min: 330, max: Infinity, rate: 0.01703 }
      ]
    };
    
    // Regional baseline data from RDN studies
    const rdnBaselines = {
      winterUsage: 540, // liters per day
      summerUsage: 1346, // liters per day
      outdoorPortion: 0.6, // 60% of summer increase is outdoor
      averageHome: 80 // gallons per day baseline
    };
    
    function nextStep(step) {
      if (!validateStep(step)) return;
      
      if (step === 2) {
        updateUsageAnalysis();
      }
      
      // Update progress bar
      document.getElementById(`step${step}`).classList.add('completed');
      document.getElementById(`step${step + 1}`).classList.add('active');
      
      // Hide current section, show next
      document.getElementById(`section${step}`).classList.remove('active');
      document.getElementById(`section${step + 1}`).classList.add('active');
      
      currentStep = step + 1;
    }
    
    function previousStep(step) {
      // Update progress bar
      document.getElementById(`step${step}`).classList.remove('active');
      document.getElementById(`step${step - 1}`).classList.remove('completed');
      
      // Hide current section, show previous
      document.getElementById(`section${step}`).classList.remove('active');
      document.getElementById(`section${step - 1}`).classList.add('active');
      
      currentStep = step - 1;
    }
    
    function validateStep(step) {
      if (step === 1) {
        const required = ['fullName', 'email', 'phoneMain', 'propertyAddress', 'city', 'postalCode'];
        for (let field of required) {
          if (!document.getElementById(field).value.trim()) {
            alert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field`);
            return false;
          }
        }
      }
      
      if (step === 2) {
        const irrigatedArea = document.getElementById('irrigatedArea').value;
        const irrigationMonths = document.getElementById('irrigationMonths').value;
        
        if (!irrigatedArea || !irrigationMonths) {
          alert('Please fill in the irrigation area and months per year');
          return false;
        }
      }
      
      if (step === 3) {
        const checkedRebates = document.querySelectorAll('input[name="rebates"]:checked:not([disabled])');
        if (checkedRebates.length === 0) {
          alert('Please select at least one upgrade option');
          return false;
        }
      }
      
      return true;
    }
    
    function updateUsageAnalysis() {
      const area = parseFloat(document.getElementById('irrigatedArea').value) || 0;
      const months = parseFloat(document.getElementById('irrigationMonths').value) || 6;
      
      // Get actual usage if provided
      const usageInputs = [
        parseFloat(document.getElementById('usage1').value) || 0, // Winter
        parseFloat(document.getElementById('usage2').value) || 0, // Fall
        parseFloat(document.getElementById('usage3').value) || 0, // Summer
        parseFloat(document.getElementById('usage4').value) || 0  // Spring
      ];
      
      const hasActualData = usageInputs.some(u => u > 0);
      
      let avgDailyUsage, summerUsage, winterUsage, outdoorPercentage, currentTier, annualCost;
      
      if (hasActualData) {
        // Use actual data
        const totalUsage = usageInputs.reduce((sum, usage) => sum + usage, 0);
        const periodsWithData = usageInputs.filter(u => u > 0).length;
        avgDailyUsage = Math.round((totalUsage / periodsWithData) / 90); // Assuming ~90 days per period
        
        summerUsage = usageInputs[2] || avgDailyUsage * 90;
        winterUsage = usageInputs[0] || avgDailyUsage * 90;
        
        const seasonalIncrease = summerUsage - winterUsage;
        outdoorPercentage = seasonalIncrease > 0 ? Math.round((seasonalIncrease / summerUsage) * 100) : 30;
      } else {
        // Use area-based estimates
        const baseIndoor = 60; // gallons per day for indoor use
        const outdoorRate = area * 0.03 * (months / 12); // Rough outdoor usage rate
        avgDailyUsage = Math.round(baseIndoor + outdoorRate);
        outdoorPercentage = Math.round((outdoorRate / avgDailyUsage) * 100);
      }
      
      // Determine current water rate tier
      currentTier = 'Tier 1';
      if (avgDailyUsage > 330) currentTier = 'Tier 4';
      else if (avgDailyUsage > 220) currentTier = 'Tier 3';
      else if (avgDailyUsage > 110) currentTier = 'Tier 2';
      
      // Calculate annual cost
      annualCost = calculateWaterCost(avgDailyUsage * 365);
      
      // Determine savings potential
      let potential = 'Moderate';
      if (avgDailyUsage > 150) potential = 'Very High';
      else if (avgDailyUsage > 100) potential = 'High';
      else if (avgDailyUsage < 60) potential = 'Limited';
      
      // Update display
      document.getElementById('avgDailyUsage').textContent = `${avgDailyUsage} gal/day`;
      document.getElementById('seasonalPeak').textContent = hasActualData ? 
        `${Math.round(summerUsage / winterUsage * 10) / 10}x` : 'Est. 2.5x';
      document.getElementById('outdoorUse').textContent = `${outdoorPercentage}%`;
      document.getElementById('currentTier').textContent = currentTier;
      document.getElementById('annualCost').textContent = `$${Math.round(annualCost)}`;
      document.getElementById('savingsPotential').textContent = potential;
      
      // Store baseline for calculations
      waterBaseline = {
        dailyUsage: avgDailyUsage,
        annualUsage: avgDailyUsage * 365,
        outdoorPortion: outdoorPercentage / 100,
        currentTier: currentTier,
        annualCost: annualCost,
        irrigatedArea: area,
        irrigationMonths: months
      };
      
      document.getElementById('usageAnalysis').style.display = 'block';
    }
    
    function calculateWaterCost(annualGallons) {
      const dailyGallons = annualGallons / 365;
      let totalCost = waterRates.baseRate * 365; // Base rate
      
      // Calculate consumption charges by tier
      for (let tier of waterRates.tiers) {
        if (dailyGallons > tier.min) {
          const tierUsage = Math.min(dailyGallons, tier.max) - tier.min;
          totalCost += tierUsage * tier.rate * 365;
        }
      }
      
      return totalCost;
    }
    
    function toggleUpgradeDetails(upgrade) {
      updateSelectedRebates();
      updateComboBonus();
      
      // Show/hide details based on selection
      const checkbox = document.getElementById(upgrade);
      const details = document.getElementById(upgrade + 'Details');
      
      if (checkbox.checked) {
        details.style.display = 'block';
      } else {
        details.style.display = 'none';
      }
    }
    
    function updateSelectedRebates() {
      selectedRebates = Array.from(document.querySelectorAll('input[name="rebates"]:checked:not([disabled])'))
                           .map(cb => cb.value);
    }
    
    function updateComboBonus() {
      const hasIrrigation = selectedRebates.some(r => ['rainSensor', 'smartController', 'dripConversion', 'mpRotators'].includes(r));
      const hasSoil = selectedRebates.includes('soilImprovements');
      
      const comboCheckbox = document.getElementById('comboBonus');
      comboCheckbox.checked = hasIrrigation && hasSoil;
    }
    
    function calculateSoilAmounts() {
      const area = parseFloat(document.getElementById('applicationArea').value) || 0;
      const depthType = document.getElementById('applicationDepth').value;
      