<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RDN Water Conservation ROI Calculator - Improved UI Demo</title>
  
  <style>
    /* Base styles from original */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background: #f0f5f3; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* Header styling */
    header { 
      background: linear-gradient(135deg, #2c5530, #3a7f42); 
      color: white; 
      padding: 60px 20px; 
      text-align: center; 
      margin-bottom: 40px; 
      border-radius: 0 0 20px 20px; 
    }
    h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
    .subtitle { font-size: 1.2em; opacity: 0.95; margin-bottom: 20px; }
    .badges { display: flex; gap: 20px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
    .badge { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-size: 0.9em; }
    
    /* Progress bar */
    .progress-bar { 
      display: flex; 
      justify-content: space-between; 
      margin-bottom: 40px; 
      position: relative; 
      padding: 0 20px;
    }
    .progress-bar::before { 
      content: ''; 
      position: absolute; 
      top: 20px; 
      left: 40px; 
      right: 40px; 
      height: 2px; 
      background: #e0e0e0; 
      z-index: 0; 
    }
    .progress-step { 
      position: relative; 
      z-index: 1; 
      text-align: center; 
      flex: 1; 
    }
    .step-circle { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      background: #e0e0e0; 
      margin: 0 auto 10px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      font-weight: bold; 
      color: white; 
      transition: all 0.3s ease; 
    }
    .progress-step.active .step-circle, 
    .progress-step.completed .step-circle { 
      background: #3a7f42; 
    }
    .step-label { font-size: 0.9em; color: #666; }
    
    /* Form sections */
    .calculator-wrapper { 
      background: white; 
      border-radius: 15px; 
      box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
      padding: 40px; 
      margin-bottom: 40px; 
    }
    
    /* Enhanced form section */
    .form-section { display: none; animation: fadeIn 0.3s ease-in; }
    .form-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    /* New upgrade selection UI */
    .upgrades-container {
      display: flex;
      gap: 30px;
      margin-top: 20px;
    }
    
    .upgrades-list {
      flex: 0 0 350px;
    }
    
    .upgrade-card {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .upgrade-card:hover {
      border-color: #3a7f42;
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .upgrade-card.selected {
      border-color: #3a7f42;
      background: #f0f8f3;
      box-shadow: 0 4px 12px rgba(58,127,66,0.15);
    }
    
    .upgrade-card.selected::after {
      content: '‚úì';
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      background: #3a7f42;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
    }
    
    .upgrade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .upgrade-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #2c5530;
    }
    
    .rebate-badge {
      background: #e74c3c;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
    }
    
    .upgrade-benefits {
      display: flex;
      gap: 15px;
      margin-top: 10px;
      font-size: 0.9em;
      color: #666;
    }
    
    .benefit-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .benefit-icon {
      color: #3a7f42;
      font-size: 1.1em;
    }
    
    /* Upgrade details panel */
    .upgrade-details-panel {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      min-height: 500px;
    }
    
    .details-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #999;
      text-align: center;
    }
    
    .details-placeholder svg {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      opacity: 0.3;
    }
    
    .upgrade-detail-content {
      display: none;
      animation: slideIn 0.3s ease;
    }
    
    .upgrade-detail-content.active {
      display: block;
    }
    
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .detail-header {
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 20px;
      margin-bottom: 25px;
    }
    
    .detail-title {
      font-size: 1.5em;
      color: #2c5530;
      margin-bottom: 10px;
    }
    
    .detail-summary {
      display: flex;
      gap: 30px;
      margin-top: 15px;
    }
    
    .summary-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .summary-label {
      color: #666;
      font-size: 0.9em;
    }
    
    .summary-value {
      font-weight: bold;
      color: #2c5530;
      font-size: 1.1em;
    }
    
    /* Enhanced cost estimate box */
    .cost-breakdown {
      background: linear-gradient(135deg, #e3f2fd 0%, #e8f5e9 100%);
      border-radius: 12px;
      padding: 25px;
      margin: 25px 0;
    }
    
    .cost-breakdown h4 {
      color: #1565c0;
      margin-bottom: 20px;
      font-size: 1.1em;
    }
    
    .cost-items {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    
    .cost-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .cost-box-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #1565c0;
      margin-bottom: 5px;
    }
    
    .cost-box-label {
      font-size: 0.85em;
      color: #666;
    }
    
    /* Form styling improvements */
    .detail-form {
      margin-top: 25px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c5530;
      font-size: 0.95em;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      transition: all 0.3s ease;
      background: #fafafa;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3a7f42;
      background: white;
    }
    
    .help-text {
      font-size: 0.85em;
      color: #666;
      margin-top: 5px;
    }
    
    /* Summary panel */
    .selection-summary {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
    }
    
    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .summary-title {
      font-weight: 600;
      color: #856404;
    }
    
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 15px;
    }
    
    .summary-metric {
      text-align: center;
    }
    
    .metric-label {
      font-size: 0.85em;
      color: #856404;
      margin-bottom: 5px;
    }
    
    .metric-value {
      font-size: 1.3em;
      font-weight: bold;
      color: #2c5530;
    }
    
    /* Navigation buttons */
    .navigation-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 40px;
      gap: 20px;
    }
    
    .btn {
      padding: 14px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: #3a7f42;
      color: white;
    }
    
    .btn-primary:hover {
      background: #2c5530;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(58,127,66,0.3);
    }
    
    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }
    
    .btn-success {
      background: #4CAF50;
      color: white;
    }
    
    .btn-success:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Results section */
    .results-section {
      display: none;
      margin-top: 40px;
    }
    
    .results-section.active {
      display: block;
    }
    
    .roi-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .roi-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.3s ease;
    }
    
    .roi-card:hover {
      transform: translateY(-2px);
    }
    
    .roi-value {
      font-size: 2em;
      font-weight: bold;
      color: #3a7f42;
      margin: 10px 0;
    }
    
    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .upgrades-container {
        flex-direction: column;
      }
      
      .upgrades-list {
        flex: none;
        width: 100%;
      }
      
      .upgrade-details-panel {
        margin-top: 20px;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .summary-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .cost-items {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1>RDN Water Conservation ROI Calculator</h1>
      <p class="subtitle">Complete Financial Analysis & Rebate Application Helper</p>
      <div class="badges">
        <span class="badge">üí∞ Up to $875 in Rebates</span>
        <span class="badge">üìä ROI & Payback Analysis</span>
        <span class="badge">üíß Water Savings Calculator</span>
        <span class="badge">üîß Installation Cost Estimates</span>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="calculator-wrapper">
      <div class="progress-bar">
        <div class="progress-step active" id="step1">
          <div class="step-circle">1</div>
          <div class="step-label">Property & Contact</div>
        </div>
        <div class="progress-step" id="step2">
          <div class="step-circle">2</div>
          <div class="step-label">Water Usage</div>
        </div>
        <div class="progress-step" id="step3">
          <div class="step-circle">3</div>
          <div class="step-label">Select Upgrades</div>
        </div>
        <div class="progress-step" id="step4">
          <div class="step-circle">4</div>
          <div class="step-label">ROI Analysis</div>
        </div>
      </div>

      <!-- Step 1: Property & Contact -->
      <div class="form-section active" id="section1">
        <h2>Property Owner Information</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" placeholder="John Smith">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="john@email.com">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="phoneMain">Phone (Main)</label>
            <input type="tel" id="phoneMain" placeholder="250-555-0123">
          </div>
          <div class="form-group">
            <label for="propertyType">Property Type</label>
            <select id="propertyType" onchange="updatePropertyDefaults()">
              <option value="single">Single Family Home</option>
              <option value="townhouse">Townhouse</option>
              <option value="condo">Condo with Garden</option>
              <option value="large">Large Estate (1+ acre)</option>
            </select>
          </div>
        </div>
        <div class="navigation-buttons">
          <div></div>
          <button class="btn btn-primary" onclick="nextStep(1)">
            Next: Water Usage
            <span>‚Üí</span>
          </button>
        </div>
      </div>

      <!-- Step 2: Water Usage (simplified) -->
      <div class="form-section" id="section2">
        <h2>Water Usage Baseline</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="irrigatedArea">Irrigated Area (sq ft)</label>
            <input type="number" id="irrigatedArea" placeholder="2000" value="2500">
            <p class="help-text">Total lawn and garden area that receives irrigation</p>
          </div>
          <div class="form-group">
            <label for="irrigationSystem">Current Irrigation System</label>
            <select id="irrigationSystem">
              <option value="manual">Manual Watering (hose/sprinkler)</option>
              <option value="timer">Basic Timer System</option>
              <option value="inground">In-ground Sprinklers</option>
              <option value="mixed">Mixed System</option>
            </select>
          </div>
        </div>
        <div class="navigation-buttons">
          <button class="btn btn-secondary" onclick="previousStep(2)">‚Üê Back</button>
          <button class="btn btn-primary" onclick="nextStep(2)">
            Next: Select Upgrades
            <span>‚Üí</span>
          </button>
        </div>
      </div>

      <!-- Step 3: Select Upgrades with Enhanced UI -->
      <div class="form-section" id="section3">
        <h2>Select Your Water Conservation Upgrades</h2>
        <p style="color: #666; margin-bottom: 20px;">Choose the upgrades you'd like to include in your ROI analysis. Click each option to see details and customize settings.</p>
        
        <div class="upgrades-container">
          <!-- Upgrade selection list -->
          <div class="upgrades-list">
            <div class="upgrade-card" onclick="selectUpgrade('rainSensor')" id="card-rainSensor">
              <div class="upgrade-header">
                <span class="upgrade-title">Rain Sensor</span>
                <span class="rebate-badge">$75 rebate</span>
              </div>
              <div class="upgrade-benefits">
                <div class="benefit-item">
                  <span class="benefit-icon">üíß</span>
                  <span>10-15% savings</span>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üåßÔ∏è</span>
                  <span>Auto shutoff</span>
                </div>
              </div>
            </div>
            
            <div class="upgrade-card" onclick="selectUpgrade('smartController')" id="card-smartController">
              <div class="upgrade-header">
                <span class="upgrade-title">Smart Controller</span>
                <span class="rebate-badge">$100 rebate</span>
              </div>
              <div class="upgrade-benefits">
                <div class="benefit-item">
                  <span class="benefit-icon">üíß</span>
                  <span>20-40% savings</span>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üì±</span>
                  <span>Weather-based</span>
                </div>
              </div>
            </div>
            
            <div class="upgrade-card" onclick="selectUpgrade('dripConversion')" id="card-dripConversion">
              <div class="upgrade-header">
                <span class="upgrade-title">Drip Irrigation</span>
                <span class="rebate-badge">$400 rebate</span>
              </div>
              <div class="upgrade-benefits">
                <div class="benefit-item">
                  <span class="benefit-icon">üíß</span>
                  <span>30-50% savings</span>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üéØ</span>
                  <span>Targeted watering</span>
                </div>
              </div>
            </div>
            
            <div class="upgrade-card" onclick="selectUpgrade('mpRotators')" id="card-mpRotators">
              <div class="upgrade-header">
                <span class="upgrade-title">MP Rotators</span>
                <span class="rebate-badge">$100 rebate</span>
              </div>
              <div class="upgrade-benefits">
                <div class="benefit-item">
                  <span class="benefit-icon">üíß</span>
                  <span>20-30% savings</span>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üåÄ</span>
                  <span>Even coverage</span>
                </div>
              </div>
            </div>
            
            <div class="upgrade-card" onclick="selectUpgrade('soilImprovements')" id="card-soilImprovements">
              <div class="upgrade-header">
                <span class="upgrade-title">Soil Improvements</span>
                <span class="rebate-badge">50% up to $100</span>
              </div>
              <div class="upgrade-benefits">
                <div class="benefit-item">
                  <span class="benefit-icon">üíß</span>
                  <span>25% less water</span>
                </div>
                <div class="benefit-item">
                  <span class="benefit-icon">üå±</span>
                  <span>Better retention</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Upgrade details panel -->
          <div class="upgrade-details-panel">
            <div class="details-placeholder" id="detailsPlaceholder">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" />
                <line x1="9" y1="9" x2="15" y2="9" />
                <line x1="9" y1="15" x2="15" y2="15" />
              </svg>
              <h3>Select an upgrade to view details</h3>
              <p>Click any upgrade option to customize settings and see cost estimates</p>
            </div>
            
            <!-- Rain Sensor Details -->
            <div class="upgrade-detail-content" id="detail-rainSensor">
              <div class="detail-header">
                <h3 class="detail-title">Rain Sensor Configuration</h3>
                <div class="detail-summary">
                  <div class="summary-item">
                    <span class="summary-label">Rebate:</span>
                    <span class="summary-value">$75</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Typical ROI:</span>
                    <span class="summary-value">1-2 years</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Installation:</span>
                    <span class="summary-value">Professional</span>
                  </div>
                </div>
              </div>
              
              <div class="cost-breakdown">
                <h4>üí∞ Cost Breakdown</h4>
                <div class="cost-items">
                  <div class="cost-box">
                    <div class="cost-box-value">$50-80</div>
                    <div class="cost-box-label">Equipment</div>
                  </div>
                  <div class="cost-box">
                    <div class="cost-box-value">$75-100</div>
                    <div class="cost-box-label">Installation</div>
                  </div>
                  <div class="cost-box">
                    <div class="cost-box-value">$150</div>
                    <div class="cost-box-label">Average Total</div>
                  </div>
                </div>
              </div>
              
              <div class="detail-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="rainSensorCost">Your Cost Estimate ($)</label>
                    <input type="number" id="rainSensorCost" value="150">
                    <p class="help-text">Adjust based on your quotes</p>
                  </div>
                  <div class="form-group">
                    <label for="rainSensorSavings">Expected Savings (%)</label>
                    <input type="number" id="rainSensorSavings" value="15" min="10" max="20">
                    <p class="help-text">10-15% is typical</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Smart Controller Details -->
            <div class="upgrade-detail-content" id="detail-smartController">
              <div class="detail-header">
                <h3 class="detail-title">Smart Controller Configuration</h3>
                <div class="detail-summary">
                  <div class="summary-item">
                    <span class="summary-label">Rebate:</span>
                    <span class="summary-value">$100</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Typical ROI:</span>
                    <span class="summary-value">2-3 years</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Installation:</span>
                    <span class="summary-value">IIABC Required</span>
                  </div>
                </div>
              </div>
              
              <div class="cost-breakdown">
                <h4>üí∞ Cost Breakdown by Zone Count</h4>
                <div class="cost-items">
                  <div class="cost-box">
                    <div class="cost-box-value">$200-400</div>
                    <div class="cost-box-label">Controller Unit</div>
                  </div>
                  <div class="cost-box">
                    <div class="cost-box-value">$150-250</div>
                    <div class="cost-box-label">Installation</div>
                  </div>
                  <div class="cost-box">
                    <div class="cost-box-value" id="controllerAvgCost">$450</div>
                    <div class="cost-box-label">Your Total</div>
                  </div>
                </div>
              </div>
              
              <div class="detail-form">
                <div class="form-row">
                  <div class="form-group">
                    <label for="controllerZones">Number of Zones</label>
                    <select id="controllerZones" onchange="updateControllerEstimate()">
                      <option value="4">4 zones</option>
                      <option value="8" selected>8 zones</option>
                      <option value="12">12 zones</option>
                      <option value="16">16 zones</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="controllerCost">Total Cost ($)</label>
                    <input type="number" id="controllerCost" value="450">
                  </div>
                </div>
                <div class="form-group">
                  <label for="controllerSavings">Expected Water Savings (%)</label>
                  <input type="number" id="controllerSavings" value="30" min="20" max="40">
                  <p class="help-text">Weather-based controllers typically save 20-40%</p>
                </div>
              </div>
            </div>
            
            <!-- Add other upgrade details similarly -->
          </div>
        </div>
        
        <!-- Selection summary -->
        <div class="selection-summary" id="selectionSummary" style="display: none;">
          <div class="summary-header">
            <h3 class="summary-title">üìä Your Selection Summary</h3>
            <span id="comboBonus" style="display: none; color: #28a745; font-weight: bold;">
              üéâ Combo Bonus Unlocked! +$100
            </span>
          </div>
          <div class="summary-grid">
            <div class="summary-metric">
              <div class="metric-label">Selected Upgrades</div>
              <div class="metric-value" id="selectedCount">0</div>
            </div>
            <div class="summary-metric">
              <div class="metric-label">Total Investment</div>
              <div class="metric-value" id="totalInvestment">$0</div>
            </div>
            <div class="summary-metric">
              <div class="metric-label">Total Rebates</div>
              <div class="metric-value" id="totalRebates">$0</div>
            </div>
            <div class="summary-metric">
              <div class="metric-label">Net Cost</div>
              <div class="metric-value" id="netCost">$0</div>
            </div>
          </div>
        </div>
        
        <div class="navigation-buttons">
          <button class="btn btn-secondary" onclick="previousStep(3)">‚Üê Previous Step</button>
          <button class="btn btn-success" id="calculateBtn" onclick="calculateROI()" disabled>
            Calculate ROI
            <span>‚Üí</span>
          </button>
        </div>
      </div>

      <!-- Step 4: Results -->
      <div class="form-section" id="section4">
        <h2>üìä ROI Analysis Results</h2>
        <div class="roi-results">
          <div class="roi-card">
            <div>üíß</div>
            <div class="roi-value" id="waterSavings">0</div>
            <div>Gallons Saved/Year</div>
          </div>
          <div class="roi-card">
            <div>üí∞</div>
            <div class="roi-value" id="costSavings">$0</div>
            <div>Annual Savings</div>
          </div>
          <div class="roi-card">
            <div>üéØ</div>
            <div class="roi-value" id="totalRebatesResult">$0</div>
            <div>Total Rebates</div>
          </div>
          <div class="roi-card">
            <div>üìÖ</div>
            <div class="roi-value" id="paybackPeriod">0</div>
            <div>Payback Period</div>
          </div>
        </div>
        
        <div class="navigation-buttons">
          <button class="btn btn-secondary" onclick="location.reload()">üîÑ New Analysis</button>
          <button class="btn btn-primary" onclick="downloadPDF()">üìÑ Download Report (PDF)</button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let selectedUpgrades = new Set();
    let currentStep = 1;
    let upgradeData = {
      rainSensor: { cost: 150, rebate: 75, savings: 15 },
      smartController: { cost: 450, rebate: 100, savings: 30 },
      dripConversion: { cost: 1200, rebate: 400, savings: 40 },
      mpRotators: { cost: 400, rebate: 100, savings: 25 },
      soilImprovements: { cost: 200, rebate: 100, savings: 25 }
    };
    
    function updatePropertyDefaults() {
      const type = document.getElementById('propertyType').value;
      const areaField = document.getElementById('irrigatedArea');
      switch(type) {
        case 'single': areaField.value = 2500; break;
        case 'townhouse': areaField.value = 1200; break;
        case 'condo': areaField.value = 500; break;
        case 'large': areaField.value = 5000; break;
      }
    }
    
    function nextStep(step) {
      document.getElementById(`step${step}`).classList.add('completed');
      document.getElementById(`step${step}`).classList.remove('active');
      document.getElementById(`step${step + 1}`).classList.add('active');
      document.getElementById(`section${step}`).classList.remove('active');
      document.getElementById(`section${step + 1}`).classList.add('active');
      currentStep = step + 1;
    }
    
    function previousStep(step) {
      document.getElementById(`step${step}`).classList.remove('active');
      document.getElementById(`step${step - 1}`).classList.remove('completed');
      document.getElementById(`step${step - 1}`).classList.add('active');
      document.getElementById(`section${step}`).classList.remove('active');
      document.getElementById(`section${step - 1}`).classList.add('active');
      currentStep = step - 1;
    }
    
    function selectUpgrade(upgradeId) {
      const card = document.getElementById(`card-${upgradeId}`);
      const isSelected = selectedUpgrades.has(upgradeId);
      
      if (isSelected) {
        selectedUpgrades.delete(upgradeId);
        card.classList.remove('selected');
      } else {
        selectedUpgrades.add(upgradeId);
        card.classList.add('selected');
      }
      
      // Show the selected upgrade's details
      showUpgradeDetails(upgradeId);
      
      // Update summary
      updateSelectionSummary();
      
      // Enable/disable calculate button
      document.getElementById('calculateBtn').disabled = selectedUpgrades.size === 0;
    }
    
    function showUpgradeDetails(upgradeId) {
      // Hide placeholder and all details
      document.getElementById('detailsPlaceholder').style.display = 'none';
      document.querySelectorAll('.upgrade-detail-content').forEach(el => {
        el.classList.remove('active');
      });
      
      // Show selected upgrade details
      const detailElement = document.getElementById(`detail-${upgradeId}`);
      if (detailElement && selectedUpgrades.has(upgradeId)) {
        detailElement.classList.add('active');
      } else if (selectedUpgrades.size === 0) {
        document.getElementById('detailsPlaceholder').style.display = 'flex';
      }
    }
    
    function updateControllerEstimate() {
      const zones = parseInt(document.getElementById('controllerZones').value);
      const baseCost = zones <= 4 ? 300 : zones <= 8 ? 450 : zones <= 12 ? 600 : 750;
      document.getElementById('controllerCost').value = baseCost;
      document.getElementById('controllerAvgCost').textContent = `$${baseCost}`;
      upgradeData.smartController.cost = baseCost;
      updateSelectionSummary();
    }
    
    function updateSelectionSummary() {
      if (selectedUpgrades.size === 0) {
        document.getElementById('selectionSummary').style.display = 'none';
        return;
      }
      
      document.getElementById('selectionSummary').style.display = 'block';
      
      let totalCost = 0;
      let totalRebates = 0;
      
      selectedUpgrades.forEach(upgradeId => {
        totalCost += upgradeData[upgradeId].cost;
        totalRebates += upgradeData[upgradeId].rebate;
      });
      
      // Check for combo bonus
      const hasIrrigation = Array.from(selectedUpgrades).some(id => 
        ['rainSensor', 'smartController', 'dripConversion', 'mpRotators'].includes(id)
      );
      const hasSoil = selectedUpgrades.has('soilImprovements');
      
      if (hasIrrigation && hasSoil) {
        totalRebates += 100;
        document.getElementById('comboBonus').style.display = 'inline';
      } else {
        document.getElementById('comboBonus').style.display = 'none';
      }
      
      document.getElementById('selectedCount').textContent = selectedUpgrades.size;
      document.getElementById('totalInvestment').textContent = `$${totalCost}`;
      document.getElementById('totalRebates').textContent = `$${totalRebates}`;
      document.getElementById('netCost').textContent = `$${totalCost - totalRebates}`;
    }
    
    function calculateROI() {
      // Simple calculation for demo
      const area = parseFloat(document.getElementById('irrigatedArea').value) || 2500;
      const baseUsage = area * 30; // gallons per year
      
      let totalSavings = 0;
      let totalCost = 0;
      let totalRebates = 0;
      
      selectedUpgrades.forEach(upgradeId => {
        const upgrade = upgradeData[upgradeId];
        totalSavings += baseUsage * (upgrade.savings / 100);
        totalCost += upgrade.cost;
        totalRebates += upgrade.rebate;
      });
      
      // Check for combo bonus
      const hasIrrigation = Array.from(selectedUpgrades).some(id => 
        ['rainSensor', 'smartController', 'dripConversion', 'mpRotators'].includes(id)
      );
      const hasSoil = selectedUpgrades.has('soilImprovements');
      if (hasIrrigation && hasSoil) {
        totalRebates += 100;
      }
      
      const annualCostSavings = totalSavings * 0.005; // $0.005 per gallon
      const netCost = totalCost - totalRebates;
      const payback = netCost / annualCostSavings;
      
      // Update results
      document.getElementById('waterSavings').textContent = Math.round(totalSavings).toLocaleString();
      document.getElementById('costSavings').textContent = `$${Math.round(annualCostSavings)}`;
      document.getElementById('totalRebatesResult').textContent = `$${totalRebates}`;
      document.getElementById('paybackPeriod').textContent = payback < 20 ? `${payback.toFixed(1)} years` : '20+ years';
      
      nextStep(3);
    }
    
    function downloadPDF() {
      if (typeof window.jsPDF === 'undefined') {
        alert('PDF generation not available. Please try again later.');
        return;
      }
      
      const { jsPDF } = window.jsPDF;
      const doc = new jsPDF();
      
      doc.setFontSize(16);
      doc.text('RDN Water Conservation ROI Analysis', 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 40);
      doc.text(`Name: ${document.getElementById('fullName').value || 'Not provided'}`, 20, 50);
      
      // Add more content as needed
      
      doc.save('RDN_Water_Conservation_ROI.pdf');
    }
  </script>
</body>
</html>